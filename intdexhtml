<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<title>МВР Система</title>
<style>
body{font-family:Arial;background:#f2f2f2}
.login,.container{max-width:1000px;margin:40px auto;background:white;padding:20px;border-radius:8px}
input,select,button{width:100%;padding:7px;margin:5px 0}
table{width:100%;border-collapse:collapse;margin-top:20px}
th,td{border:1px solid #000;padding:8px;text-align:center}
.delete{background:red;color:white;border:none}
.edit{background:orange;border:none;margin:2px}
.logout{background:#444;color:white}
</style>
</head>
<body>

<div class="login" id="loginBox">
    <h2>Вход</h2>
    <input id="username" placeholder="Потребител">
    <input id="password" type="password" placeholder="Парола">
    <button onclick="login()">Вход</button>
    <p id="error" style="color:red"></p>
</div>

<div class="container" id="system" style="display:none;">
    <h2>МВР Регистър</h2>
    <p>Влезнал като: <b id="role"></b></p>

    <div id="addForm">
        <input id="firstName" placeholder="Първо име">
        <input id="lastName" placeholder="Второ име">
        <input id="years" type="number" placeholder="Години">
        <input id="permit" placeholder="Разрешително">
        <select id="license">
            <option>Да</option>
            <option>Не</option>
        </select>
        <button onclick="saveData()">Запази</button>
    </div>

    <button class="logout" onclick="logout()">Изход</button>

    <table>
        <thead>
            <tr>
                <th>Име</th>
                <th>Години</th>
                <th>Разрешително</th>
                <th>Книжка</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody id="dataTable"></tbody>
    </table>
</div>

<script>
let currentUser="";
let data = JSON.parse(localStorage.getItem("records")) || [];

// Проверка за persistent login
if(localStorage.getItem("currentUser")){
    currentUser = localStorage.getItem("currentUser");
    loginBox.style.display="none";
    system.style.display="block";
    role.innerText=currentUser;
    renderTable();
}

function login(){
    const u=username.value;
    const p=password.value;

    if(u==="Полицай" && p==="1234567") currentUser="Полицай";
    else if(u==="Пътна полиция" && p==="123456789") currentUser="Пътна полиция";
    else if(u==="Комисар" && p==="1234567890") currentUser="Комисар";
    else if(u==="Шеф" && p==="12345678") currentUser="Шеф";
    else{
        error.innerText="Грешно име или парола";
        return;
    }

    localStorage.setItem("currentUser", currentUser);

    loginBox.style.display="none";
    system.style.display="block";
    role.innerText=currentUser;
    renderTable();
}

function logout(){
    localStorage.removeItem("currentUser");
    location.reload();
}

function saveData(){
    if(!firstName.value || !lastName.value) return;
    data.push({
        name:firstName.value+" "+lastName.value,
        years:years.value,
        permit:permit.value,
        license:license.value
    });
    localStorage.setItem("records",JSON.stringify(data));
    renderTable();
    firstName.value=""; lastName.value=""; years.value=""; permit.value="";
}

function toggleLicense(i){
    if(currentUser!=="Пътна полиция" && currentUser!=="Шеф") return;
    data[i].license = data[i].license==="Да" ? "Не" : "Да";
    localStorage.setItem("records",JSON.stringify(data));
    renderTable();
}

function editPermit(i){
    if(currentUser!=="Комисар" && currentUser!=="Шеф") return;
    const newPermit = prompt("Ново разрешително:", data[i].permit);
    if(newPermit!==null){
        data[i].permit = newPermit;
        localStorage.setItem("records",JSON.stringify(data));
        renderTable();
    }
}

function deleteRecord(i){
    if(currentUser!=="Шеф") return;
    data.splice(i,1);
    localStorage.setItem("records",JSON.stringify(data));
    renderTable();
}

function renderTable(){
    dataTable.innerHTML="";
    data.forEach((r,i)=>{
        dataTable.innerHTML+=`
        <tr>
            <td>${r.name}</td>
            <td>${r.years}</td>
            <td>${r.permit}</td>
            <td>${r.license}</td>
            <td>
                ${(currentUser==="Пътна полиция" || currentUser==="Шеф")
                    ? `<button class="edit" onclick="toggleLicense(${i})">Книжка</button>` : ``}
                ${(currentUser==="Комисар" || currentUser==="Шеф")
                    ? `<button class="edit" onclick="editPermit(${i})">Разреш.</button>` : ``}
                ${(currentUser==="Шеф")
                    ? `<button class="delete" onclick="deleteRecord(${i})">Изтрий</button>` : ``}
            </td>
        </tr>`;
    });
}
</script>

</body>
</html>

